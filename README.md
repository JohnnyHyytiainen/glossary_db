# Glossary DB (FastAPI + PostgreSQL)
![Python](https://img.shields.io/badge/Python-FFD43B?style=for-the-badge&logo=python&logoColor=blue)
![Pydantic](https://img.shields.io/badge/Pydantic-E92063?style=for-the-badge&logo=Pydantic&logoColor=white)
![PostgreSQL](https://img.shields.io/badge/PostgreSQL-316192?style=for-the-badge&logo=postgresql&logoColor=white)
![Docker](https://img.shields.io/badge/Docker%20Compose-2496ED?style=for-the-badge&logo=docker&logoColor=white)
![FastAPI](https://img.shields.io/badge/fastapi-109989?style=for-the-badge&logo=FASTAPI&logoColor=white)
![Gemini](https://img.shields.io/badge/Google%20Gemini-8E75B2?style=for-the-badge&logo=googlegemini&logoColor=white)
![AI](https://img.shields.io/badge/AI%20RAG-ChromaDB-FF6F00?style=for-the-badge)
![License](https://img.shields.io/badge/License-MIT-green)

**A modern backend API for a technical glossary. It stores normalized glossary data in PostgreSQL, exposes clean JSON via FastAPI, and features a built-in **Retrieval-Augmented Generation (RAG)** engine for semantic search and AI-powered Q&A.**

## Features (v1.3.0)
- **AI RAG Engine:** Ask questions to the database via Google Gemini (`/ask`), restricted to only use internal glossary data.

- **Explainable AI (XAI):** AI responses include exact source tracking (`sources: [...]`) to prevent hallucinations.

- **Semantic Search:** Vector embeddings (Sentence-Transformers) and ChromaDB integration (`/search`).

- **Normalized DB Schema:** Terms, Categories, Sources + M:N association tables.

- **FastAPI Endpoints:** Dependency Injection, Pydantic response models, and pagination.

- **Robust ETL Pipelines:** Scripts for seeding PostgreSQL from CSV and embedding vectors into ChromaDB.

## Tech Stack
- **Backend:** Python 3.12+, FastAPI, Uvicorn, Pydantic

- **Database:** PostgreSQL (Docker), SQLAlchemy 2.x, Alembic

- **AI & Vector DB:** ChromaDB, `all-MiniLM-L6-v2` (Sentence-Transformers), Google Gemini API

- **Tooling:** `uv`, Pytest, Ruff, Black

---

## Project Structure

```text
glossary_db/
├── data/                # Raw and cleaned CSV files for ingestion
├── docs/modules         # Extensive documentation (CDM/LDM/PDM diagrams,theory, modules)
├── scripts/             # Vector ETL scripts (embed_terms.py)
├── src/                 # Main FastAPI Application (rag.py, models, endpoints)
├── tests/               # Pytest suite
├── .env.example         # Template for environment variables
├── docker-compose.yml   # Local infrastructure (PostgreSQL)
└── README.md
```

## Quickstart

### Prerequisites
- Docker / Docker Desktop
- `uv` installed
- Google Gemini API key (for the `/ask` endpoint)

### 1) Clone & configure env
```bash
git clone https://github.com/JohnnyHyytiainen/glossary_db.git
cd glossary_db
cp .env.example
```
Create a local `.env` from the example:

**Important:** Open your `.env` file and add your GEMINI_API_KEY=your_key_here.
```bash
cp .env.example .env
```

> The app reads configuration via `pydantic-settings`. Keep secrets in `.env` (never commit them).

### 2) Start PostgreSQL (Docker)

```bash
docker compose up -d
```

### 3) Install dependencies

```bash
uv sync
```

### 4) Run migrations (create tables)

```bash
# Create tables
uv run alembic upgrade head

# Seed PostgreSQL from CSV
uv run python -m src.seed_csv

# If you see:
ModuleNotFoundError: No module named src, run scripts as modules:

# Do use: 
uv run python -m src.seed

# Dont use:
uv run src/seed.py
```

### 5) Build the Vector Database (ChromaDB)
To enable the AI and semantic search features, run the vector ETL script. This will generate embeddings and store them locally.
```bash
uv run python -m scripts.embed_terms
```

### 6) Run the API
```bash
uv run uvicorn src.main:app --reload
```
**Open Swagger UI to test the endpoints: http://127.0.0.1:8000/docs**

## API Endpoints
**AI & Semantic Search (New in v1.3.0)**

- GET /search?q=...&k=5
Semantic search directly against ChromaDB. Returns top matches with cosine distances and text snippets. Perfect for testing retrieval logic.

- POST /ask
The RAG engine. Accepts a JSON payload ({"query": "What is a container?"}) and returns a pedagogical answer generated by Google Gemini, including an array of specific sources used to build the answer.

- Glossary CRUD
  - GET /terms (Pagination: ?skip=0&limit=10, Filtering: ?category=python, ?search=etl)

  - GET /terms/{term_slug}

  - GET /random

  - GET /health

**Notes:**

* `limit` is capped at 100.
* Responses include nested `categories` and `sources` (optimized to avoid N+1 queries).
--- 


## Documentation

Check the /docs folder for deep dives into the system architecture:  

- **[Conceptual, Logical and Physical data models](docs/diagrams/)**  
- **[RAG Flow Architecture](docs/modules/rag_flow_architecture.md)**  
- **[Database Schema design](docs/modules/database_schema_design.md)**  
- **[Database overview](docs/modules/database_overview.md)**


## Tests & Linting

```bash
uv run pytest -v
uv run ruff check .
uv run black .
```

---

## Data Model (high level)

* `terms` (core entity)
* `categories`
* `sources`
* `term_categories` (M:N)
* `term_sources` (M:N)

---

## Troubleshooting and quick run commands
- **[Quick setup commands](docs/modules/quick_setup_commands.md)**


